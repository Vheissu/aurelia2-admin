<div class="page">
  <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
    <div>
      <h2 class="text-3xl font-semibold">Users</h2>
      <p class="text-sm text-[color:var(--muted)]">Manage access, roles, and invitations.</p>
    </div>
    <button click.trigger="showAddUserForm = !showAddUserForm" class="btn-primary">
      ${showAddUserForm ? 'Close form' : 'Add user'}
    </button>
  </div>

  <div class="grid gap-4 md:grid-cols-3">
    <div class="card p-4">
      <div class="text-xs uppercase tracking-[0.2em] text-[color:var(--muted)]">Total users</div>
      <div class="text-2xl font-semibold mt-2">${users.length}</div>
      <div class="text-xs text-[color:var(--muted)]">Active in the last 30 days</div>
    </div>
    <div class="card p-4">
      <div class="text-xs uppercase tracking-[0.2em] text-[color:var(--muted)]">Admins</div>
      <div class="text-2xl font-semibold mt-2">${adminCount}</div>
      <div class="text-xs text-[color:var(--muted)]">Full access granted</div>
    </div>
    <div class="card p-4">
      <div class="text-xs uppercase tracking-[0.2em] text-[color:var(--muted)]">Standard users</div>
      <div class="text-2xl font-semibold mt-2">${userCount}</div>
      <div class="text-xs text-[color:var(--muted)]">Workspace contributors</div>
    </div>
  </div>

  <div class="card p-4 flex flex-col gap-4">
    <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
      <div class="search w-full lg:max-w-md">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input
          type="text"
          value.bind="searchQuery"
          input.trigger="filterUsers()"
          placeholder="Search by name, email, or role"
        />
      </div>
      <div class="flex flex-wrap gap-2">
        <span class="pill">Active</span>
        <span class="pill">Admins</span>
        <span class="pill">Invited</span>
      </div>
    </div>
  </div>

  <div if.bind="showAddUserForm" class="card p-4">
    <h3 class="text-lg font-semibold mb-4">Add a new user</h3>
    <div class="grid gap-4 lg:grid-cols-3">
      <input type="text" value.bind="newUser.name" placeholder="Full name" class="input" />
      <input type="email" value.bind="newUser.email" placeholder="Email" class="input" />
      <select value.bind="newUser.role" class="input">
        <option value="User">User</option>
        <option value="Admin">Admin</option>
      </select>
    </div>
    <div class="flex justify-end mt-4">
      <button click.trigger="addUser()" class="btn-primary">Add user</button>
    </div>
  </div>

  <div class="card overflow-hidden">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr repeat.for="user of users">
          <td>
            <span if.bind="editingUserId !== user.id">${user.name}</span>
            <input if.bind="editingUserId === user.id" type="text" value.bind="user.name" class="input" />
          </td>
          <td>
            <span if.bind="editingUserId !== user.id">${user.email}</span>
            <input if.bind="editingUserId === user.id" type="email" value.bind="user.email" class="input" />
          </td>
          <td>
            <span if.bind="editingUserId !== user.id">
              <span if.bind="user.role === 'Admin'" class="pill">Admin</span>
              <span if.bind="user.role !== 'Admin'" class="badge">User</span>
            </span>
            <select if.bind="editingUserId === user.id" value.bind="user.role" class="input">
              <option value="User">User</option>
              <option value="Admin">Admin</option>
            </select>
          </td>
          <td>
            <div class="flex flex-wrap gap-2">
              <button if.bind="editingUserId !== user.id" click.trigger="editUser(user)" class="btn-secondary">Edit</button>
              <button if.bind="editingUserId === user.id" click.trigger="updateUser(user)" class="btn-primary">Save</button>
              <button if.bind="editingUserId === user.id" click.trigger="cancelEdit()" class="btn-ghost">Cancel</button>
              <button click.trigger="deleteUser(user.id)" class="btn-ghost">Remove</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div if.bind="users.length === 0" class="text-center py-4 text-[color:var(--muted)]">
    No users found matching your search.
  </div>
</div>
